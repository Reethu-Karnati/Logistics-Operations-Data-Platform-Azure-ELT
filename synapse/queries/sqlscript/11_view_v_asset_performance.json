{
	"name": "11_view_v_asset_performance",
	"properties": {
		"content": {
			"query": "CREATE OR ALTER VIEW v_asset_performance AS\nSELECT\n    a.asset_id,\n\n    COUNT(*) AS total_events,\n\n    SUM(CASE WHEN f.Logistics_Delay = 1 THEN 1 ELSE 0 END) AS delayed_events,\n\n    CASE \n        WHEN COUNT(*) = 0 THEN 0\n        ELSE 1.0 * SUM(CASE WHEN f.Logistics_Delay = 1 THEN 1 ELSE 0 END) / COUNT(*)\n    END AS delay_rate,\n\n    AVG(CAST(f.Waiting_Time AS FLOAT))              AS avg_waiting_time,\n    AVG(CAST(f.Asset_Utilization AS FLOAT))         AS avg_asset_utilization,\n    AVG(CAST(f.User_Transaction_Amount AS FLOAT))   AS avg_transaction_amount,\n    AVG(CAST(f.User_Purchase_Frequency AS FLOAT))   AS avg_purchase_frequency\nFROM fact_logistics_events f\nLEFT JOIN dim_asset a\n    ON f.asset_key = a.asset_key\nGROUP BY\n    a.asset_id;\nGO\n\n-- Test\nSELECT * FROM v_asset_performance ORDER BY delay_rate DESC;\nGO",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "master",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}