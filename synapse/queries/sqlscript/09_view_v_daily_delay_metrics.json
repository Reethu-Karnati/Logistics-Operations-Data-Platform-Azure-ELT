{
	"name": "09_view_v_daily_delay_metrics",
	"properties": {
		"content": {
			"query": "CREATE OR ALTER VIEW v_daily_delay_metrics AS\nSELECT\n    d.[date],\n    d.[year],\n    d.[month],\n    d.[day],\n    d.weekday_name,\n\n    COUNT(*) AS total_events,\n\n    SUM(CASE WHEN f.Logistics_Delay = 1 THEN 1 ELSE 0 END) AS delayed_events,\n\n    CASE \n        WHEN COUNT(*) = 0 THEN 0\n        ELSE 1.0 * SUM(CASE WHEN f.Logistics_Delay = 1 THEN 1 ELSE 0 END) / COUNT(*)\n    END AS delay_rate,\n\n    AVG(CAST(f.Waiting_Time AS FLOAT))        AS avg_waiting_time,\n    AVG(CAST(f.Asset_Utilization AS FLOAT))   AS avg_asset_utilization\nFROM fact_logistics_events f\nJOIN dim_date d\n    ON f.date_key = d.date_key\nGROUP BY\n    d.[date],\n    d.[year],\n    d.[month],\n    d.[day],\n    d.weekday_name;\nGO\n\n-- Test\nSELECT TOP 50 * FROM v_daily_delay_metrics ORDER BY [date];\nGO",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "master",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}