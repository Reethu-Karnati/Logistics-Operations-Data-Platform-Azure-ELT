{
	"name": "SQL script 28",
	"properties": {
		"content": {
			"query": "CREATE OR ALTER VIEW v_asset_traffic_performance AS\nSELECT\n    da.asset_id,\n    dts.traffic_status_name,\n    COUNT(*) AS total_trips,\n    SUM(CASE WHEN f.logistics_delay = 1 THEN 1 ELSE 0 END) * 1.0\n        / NULLIF(COUNT(*), 0) AS delay_rate,\n    AVG(f.waiting_time) AS avg_waiting_time,\n    AVG(f.asset_utilization) AS avg_asset_utilization,\n    AVG(f.user_transaction_amount) AS avg_revenue_per_trip\nFROM fact_logistics_events AS f\nJOIN dim_asset AS da\n    ON f.asset_key = da.asset_key\nJOIN dim_traffic_status AS dts\n    ON f.traffic_status_key = dts.traffic_status_key\nGROUP BY\n    da.asset_id,\n    dts.traffic_status_name;\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "logistics_db",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}