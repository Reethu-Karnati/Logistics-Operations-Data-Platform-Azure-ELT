{
	"name": "SQL script 30",
	"properties": {
		"content": {
			"query": "CREATE OR ALTER VIEW v_asset_revenue_risk AS\nSELECT\n    da.asset_id,\n    COUNT(*) AS total_trips,\n    AVG(f.user_transaction_amount) AS avg_revenue_per_trip,\n    SUM(f.user_transaction_amount) AS total_revenue,\n    SUM(CASE WHEN f.logistics_delay = 1 THEN 1 ELSE 0 END) * 1.0 \n        / NULLIF(COUNT(*), 0) AS delay_rate,\n    AVG(f.waiting_time) AS avg_waiting_time,\n    AVG(f.asset_utilization) AS avg_asset_utilization\nFROM fact_logistics_events f\nJOIN dim_asset da\n    ON f.asset_key = da.asset_key\nGROUP BY da.asset_id;\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "logistics_db",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}